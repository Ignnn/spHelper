---
title: "Plotting examples"
author: "Vilmantas Gegzna"
date: "`r Sys.Date()`"
output:
    rmarkdown::html_vignette: 
        toc: yes
        number_sections: yes

vignette: >
  %\VignetteIndexEntry{Plotting examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteDepends{plotly}
  %\VignetteEncoding{UTF-8}
---
```{r options, echo = FALSE, message = FALSE, warning = FALSE}
optDEF <- knitr::opts_chunk$get()
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")

knitr::opts_chunk$set(fig.width = 6, fig.align = 'center')
```

Load packages
==============
```{r Load packages, message = FALSE, warning = FALSE}
library(spHelper)
library(plotly)

```

`plot_kSp` and `plot_kSpFacets`
===============================
```{r plot_kSpFacets}
library(hyperSpec)
plot_kSpFacets(flu, Title = "Flu dataset")
plot_kSpFacets(flu, Title = "Flu dataset", normalize = 1)
plot_kSpFacets(flu, Title = "Flu dataset", normalize = FALSE)
plot_kSpFacets(flu, Title = "Flu dataset", normalize = -1)

```

Remove fill
------------
```{r}
flu$c2 <- as.factor(flu$c)
plot_kSp(flu, Title = "Flu dataset", names = 'c2', filled = F)
```

Name of the legend
------------------
```{r}
plot_kSp(flu, Title = "Flu dataset", names = 'c2', legendName = FALSE)
plot_kSp(flu, Title = "Flu dataset", names = 'c2', legendName = TRUE)
plot_kSp(flu, Title = "Flu dataset", names = 'c2', legendName = "Concentration")
```

Examples using package `plotly`
-------------------------------
```{r,fig.width= 5, fig.cap = "**Fig2.** 'Plotly' example."}

dsamp <- diamonds[sample(nrow(diamonds), 1000), ]
qplot(carat, price, data = dsamp, colour = clarity) %>% ggplotly()

```

```{r, fig.align='center',fig.width= 5, fig.cap = c("**Fig1.** Spectra of Components (_hyperSpec_ package)", "**Fig2.** Spectra of Components (_spHelper_ package)","**Fig3.** Spectra of Components (_spHelper_ and _plotly_ packages)", "**Fig4.** Amplitudes by groups (_spHelper_ package)")}
data("Loadings")

plot_kSpFacets(Loadings)
plot_kSpFacets(Loadings) %>% ggplotly()
```

`plot_kAmp`
===============================
```{r}
data(Scores)
plot_kAmp(Scores)

data(Scores3)
plot_kAmp(Scores3, by = "class")

```

`uniPeak` - Transform Spectra of Components
==============================================
```{r}
 #  Example 1 -------------------------------------------------------

 x     <- seq(-10,20,.1)
 y0    <- GaussAmp(x, c = 0, A = 1) + GaussAmp(x, c = 10, A = 2) - .5
 y0NEW <- uniPeak(y0)

 # Plot the results
 par(mfrow = c(1,1))
 plot( x, y0,    type = "l", lty = 3,
         main = "'uniPeak' keeps positive part \n of highest peak only" );
 lines(x, y0NEW, type = "l", lty = 1, lwd = 3);
 legend("topleft", legend = c("Before","After"), lty = c(3,1))

```

```{r, fig.height=10}
 #  Example 2 -------------------------------------------------------

 x  = seq(-10,20,.1)
 y1 = (sin(x/4) + GaussAmp(x))
 y2 = (2*sin(x) + sin(x/5) + GaussAmp(x, c = 5))
 y  = base::rbind(y1,y2)

 yNEW <- apply(y,1,uniPeak)

 par(mfrow = c(3,1))

 # plot 1
 matplot(x, t(y), type = "l", lty = 3,
         main = "A - Initial curves");
 abline(h = 0)

 # plot 2
 matplot(x,yNEW, type = "l", lty = 1,lwd = 3,
         main = "B - Only the highest positive\n peaks per curve");
 abline(h = 0)

 # plot 3: both plots together
 matplot(x, t(y), type = "l", lty = 3, main = "A and B together");
 matlines(x,yNEW, type = "l", lty = 1,lwd = 3);
 abline(h = 0)
 
 par(mfrow = c(1,1))
```

`plot_stat` - Plot Summary Statistic of Spactra
================================================

```{r}
 plot_stat(chondro,clusters,mean)
 plot_stat(chondro,clusters,mean,All = FALSE)
 plot_stat(chondro,clusters,mean_sd,All = FALSE) + facet_grid(.~clusters)

 plot_stat(chondro,clusters,median,All = FALSE, fixed.colors = FALSE)
 plot_stat(chondro,clusters,median, "My Title")


 # Use `.aggregate` in making facets, to avoid facet called "NA":

 plot_stat(chondro,clusters,mean_pm_sd) + facet_grid(.~clusters)
 plot_stat(chondro,clusters,mean_pm_sd) + facet_grid(.~.aggregate)
```

Examples with the other dataset

```{r}
 plot_stat(Spectra,gr,mean)
 plot_stat(Spectra,gr,mean,All = FALSE)
 plot_stat(Spectra,gr,mean_sd,All = FALSE) + facet_grid(.~gr)

 plot_stat(Spectra,gr,median,All = FALSE, fixed.colors = FALSE)
 plot_stat(Spectra,gr,median, "My Title")


 # Use `.aggregate` in making facets, to avoid facet called "NA":

 plot_stat(Spectra,gr,mean_pm_sd) + facet_grid(.~gr)
 plot_stat(Spectra,gr,mean_pm_sd) + facet_grid(.~.aggregate)
```

`subt` - Title and Subtitle 
==============================
```{r}
 subt("Cars")
 ## bold("Cars")

 subt("Cars","Distance vs. speed")
 ## atop(bold("Cars"), atop(italic("Distance vs. speed")))

 # ----------------------------------------------------------------

 plot(cars[,1:2], main = "Cars")
 plot(cars[,1:2], main = subt("Cars")) # the same as in previous line
 plot(cars[,1:2], main = subt("Cars","Distance vs. speed"))
 plot(cars[,1:2], main = subt(subTitle = "Distance vs. speed"))

 # ----------------------------------------------------------------

 library(ggplot2)

 g <- qplot(mpg, wt, data = mtcars)
 g + ggtitle("Cars") # non-bold title
 g + ggtitle(subt("Cars")) # bold title
 g + ggtitle(subt("Cars","Distance vs. speed"))
 g + ggtitle(subt(subTitle = "Distance vs. speed"))


 # ----------------------------------------------------------------

 library(lattice)

 xyplot(eruptions~waiting, data = faithful)

 xyplot(eruptions~waiting, data = faithful,
  main = "Old Faithful Geyser Data")

 xyplot(eruptions~waiting, data = faithful,
  main = subt("Old Faithful Geyser Data"))

 xyplot(eruptions~waiting, data = faithful,
  main = subt("Old Faithful Geyser", "Data"))

 xyplot(eruptions~waiting, data = faithful,
  main = subt(subTitle = "Old Faithful Geyser Data"))
```


`plot_confusion`
================


```{r, echo=FALSE}
# knitr::opts_chunk$set(optDEF)
# 
knitr::opts_chunk$set(fig.width = 5, fig.show = "hold")
```
```{r}
d <- 5 # number of rows/columns
Mat <- matrix(sample(0:100,d ^ 2,T),d)
colnames(Mat) <- paste0("gr",1:d)
rownames(Mat) <- colnames(Mat)
class(Mat)
plot_confusion(Mat, subTitle = "Input is a matrix (1)")

diag(Mat)[2:3] <- c(1000,250)
plot_confusion(Mat, subTitle = "Input is a matrix (2)")
```
```{r}
set.seed(165)

N <- 1000 # number of observations

Prediction <- sample(c("A","B","C","D"),N, replace = TRUE)
Reference  <- sample(c("A", "B","C","D"),N, replace = TRUE)

# Random guess  =====================
conf <- table(Prediction,Reference)
class(conf)

plot_confusion(conf, subTitle = "Correct by chance")

# At least 40% of the cases agree =====================
ind2 <- sample(1:N,round(N*.50))
Reference[ind2] <- Prediction[ind2]
conf2 <- table(Prediction,Reference)

plot_confusion(conf2, subTitle = "Correct >50%")

# Most of the cases agree =============================
ind3 <- sample(1:N,round(N*.80))
Reference[ind3] <- Prediction[ind3]
conf3 <- table(Prediction,Reference)

plot_confusion(conf3, subTitle = "Correct >80%")
```

```{r}
# Proportions =========================================

plot_confusion(conf3              , subTitle = "Counts")
# plot_confusion(prop.table(conf3),   subTitle = "Proportions (total sum = 1)")
# plot_confusion(prop.table(conf3,1), subTitle = "Proportions (row sums = 1)")
# plot_confusion(prop.table(conf3,2), subTitle = "Proportions (column sums = 1)")
```

```{r}
# Shades: proportional ================================

plot_confusion(conf,shades = "prop",  subTitle = "Shades: 'prop', Correct by chance");
plot_confusion(conf,shades = "max",   subTitle = "Shades: 'max', Correct by chance")

plot_confusion(conf2,shades = "prop", subTitle = "Shades: 'prop', Correct >50%");
plot_confusion(conf2,shades = "max",  subTitle = "Shades: 'max', Correct >50%")

plot_confusion(conf3,shades = "prop", subTitle = "Shades: 'prop', Correct >80%");
plot_confusion(conf3,shades = "max",  subTitle = "Shades: 'max', Correct >80%")
```

```{r}
# Shades: constant and none ===========================

plot_confusion(conf3,shades = "const",subTitle = "Shades: constant"); plot_confusion(conf3,shades = "none", subTitle = "Shades: none")

```

```{r}
n <- round(N/6)
Prediction[sample(which(Prediction == "A"),n,replace = TRUE)] <- sample(c("B","C"), n,replace = TRUE)
conf4 <- table(Prediction,Reference)

plot_confusion(conf4, subTitle = "Imbalanced class proportions")



```
Test `rowSums` and `colSums`
============================
```{r}
n <- 3
m <- matrix(rep(1:n,each = n),n)
rownames(m) <- paste0("row",1:n)
colnames(m) <- paste0("col",1:n)
m <- as.table(m)
m
rowSums(m)
colSums(m)
```
`InfoDim` and `InfoDim_plot`
============================
```{r, fig.width= 6}
 my_matrix <- matrix(rexp(200, rate = .1), ncol = 20)
 my_result <- InfoDim(my_matrix)
 
 # Investigate the result
 str(my_result)
 my_result$exactDim
 my_result$dim
 
 #Plot
 my_plot <- InfoDim_plot(my_result)
 my_plot
```

